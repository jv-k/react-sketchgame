(this["webpackJsonpreact-sketchgame"]=this["webpackJsonpreact-sketchgame"]||[]).push([[0],{25:function(e,t,a){e.exports=a(50)},39:function(e,t){},40:function(e,t){},41:function(e,t){},42:function(e,t){},43:function(e,t){},44:function(e,t){},45:function(e,t,a){},47:function(e){e.exports=JSON.parse('["bird","book","car","cat","chair","flower","plane","sheep","ship","strawberry"]')},49:function(e,t,a){},50:function(e,t,a){"use strict";a.r(t);var n=a(1),s=a.n(n),l=a(22),o=a.n(l),c=a(7);const r=()=>s.a.createElement("h1",null,"Sketch!",s.a.createElement("i",{className:"snes-jp-logo is-large ml-2"})),i=e=>s.a.createElement("button",{className:"nes-btn"+(e.className?" "+e.className:""),onClick:e.click,style:e.style,id:e.id},e.label),m=e=>e.route?s.a.createElement(c.b,{to:e.route,className:e.className||e.linkClassName,style:e.style||e.linkStyle,onClick:e.click},s.a.createElement(i,{label:e.label,className:e.buttonClassName,id:e.id})):s.a.createElement(i,e),d=({isChecked:e,onChange:t,id:a})=>{const[l,o]=Object(n.useState)(e);return s.a.createElement("label",{className:"mr-5"},s.a.createElement("input",{type:"checkbox",className:"nes-checkbox",checked:l,onChange:e=>{o(e.target.checked),t(e.target.checked)},id:a}),s.a.createElement("span",null,"Sound"))},u=s.a.createContext();u.displayName="GameContext";const h=u.Provider,p=s.a.createContext();p.displayName="RoundContext";const f=p.Provider,g=()=>Object(n.useContext)(u);var E=a(2);const b=()=>{const e=g(),t=Object(n.useContext)(p),a=100-Math.round((e.timeLimit-t.timeLeft)/e.timeLimit*100);return s.a.createElement("div",{className:"nes-container is-centered is-rounded mb-3"},s.a.createElement("p",{className:""},"Round ",t.index+1," of ",e.noRounds),s.a.createElement("progress",{className:"m-0 nes-progress "+(100===a?"is-pattern is-faded":a<20?"is-error":"is-success"),value:a,max:"100",style:{height:"28px"}}))},N=s.a.forwardRef((e,t)=>{let a,l,[o,c]=Object(n.useState)(!1);return Object(n.useEffect)(()=>{const e=t.current,a=e.getContext("2d");a.fillStyle="#ffffff",a.fillRect(0,0,e.height,e.width)},[t]),s.a.createElement("canvas",{height:300,width:300,ref:t,onMouseDown:()=>c(!0),onMouseUp:()=>{c(!1),[a,l]=[void 0,void 0]},onMouseMove:e=>(e=>{const t=e.target.getBoundingClientRect(),n=e.clientX-t.left,s=e.clientY-t.top;o&&([a,l]=function(e,t,a,n,s){let l=e.getContext("2d");return l.strokeStyle="#000000",l.lineWidth=12,l.lineJoin="round",l.beginPath(),l.moveTo(n,s),l.lineTo(t,a),l.closePath(),l.stroke(),[t,a]}(e.target,n,s,a,l))})(e)})}),y=s.a.forwardRef((e,t)=>s.a.createElement("div",{className:"nes-container is-rounded mb-3 p-0",style:{width:"310px",height:"310px"}},s.a.createElement(N,{ref:t})));function v(e,t=0){const a=Math.floor(Math.random()*e);return a*t<10?a:v(e,t)}var w=a(10),x=a.n(w);class k extends s.a.Component{constructor(e){super(),this.getQuestion=()=>{const{wonLastRound:e}=this.context,t=this.context.msgs,a=0===this.context.currentRound;return(a?t.intro:e?t.pointScore[v(t.pointScore.length)]:t.pointLose[v(t.pointLose.length)])+t.pause+t.question.replace("{{label}}",this.props.label).replace("{{timeLeft}}",this.props.timeLeft)+(a?t.questionSuffix:"!")},this.state={timeRef:s.a.createRef(),isTyped:!1},this.typed={}}componentDidUpdate(){const e=document.getElementById("timeLeft");null!==e&&(e.innerText=this.props.timeLeft)}componentDidMount(){this.typed=new x.a(".msgTxt",{strings:[this.getQuestion()],typeSpeed:20,onComplete:e=>{this.props.callBack()}})}componentWillUnmount(){this.typed.destroy()}render(){return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"nes-balloon from-right w-100 mt-1"},s.a.createElement("span",{className:"msgTxt"})),s.a.createElement("i",{className:"nes-mario reflect-h float-right"}))}}k.contextType=u;var S=a(18);const O=new class{constructor(e){this.play=(e,t)=>{t&&(this.sfx[e].loaded?this.sfx[e].start():S.Buffer.on("load",()=>{this.sfx[e].start()}),console.log("SFX: ",e))},this.stop=e=>{this.sfx[e].stop()},this.silence=()=>{Object.keys(this.sfx).map(e=>this.sfx[e].stop())},this.destroy=()=>{Object.keys(this.sfx).map(e=>this.sfx[e].dispose())},this.sfx={},Object.keys(e.sfx).map(t=>this.sfx[t]=new S.Player(e.path+e.sfx[t]).toMaster())}}({path:"./assets/sounds/",sfx:{click:"btn.wav",clear:"clear.wav",game_lose:"game_lose.wav",game_win:"game_win.wav",point_win:"point_win.wav",point_lose:"point_lose.wav",time_tick:"time_seconds.wav",time_warn:"time_warning.wav",theme:"theme.wav",quit:"point_lose.wav"}}),R=Object(E.g)(e=>{const[t]=I("soundOn");return s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col"},s.a.createElement(m,{label:"Clear",click:()=>{(e=>{const t=e.current;t.getContext("2d").fillRect(0,0,t.height,t.width)})(e.canvasRef),O.play("clear",t)},className:"is-warning"}),s.a.createElement(m,{label:"Next >",click:()=>e.NextBtnCallBack(),className:"is-success",id:"btn-next"})),s.a.createElement("div",{className:"col"},s.a.createElement(m,{label:"Quit",click:()=>{O.play("click",t);var a=document.getElementById("dialog-rounded");void 0!==a.showModal?a.showModal():e.history.push("/")},className:"float-right",id:"btn-quit"}),s.a.createElement("dialog",{className:"nes-dialog is-rounded",id:"dialog-rounded"},s.a.createElement("form",{method:"dialog"},s.a.createElement("p",null,"Are you sure?!"),s.a.createElement("menu",{className:"dialog-menu"},s.a.createElement(m,{label:"Quit!",route:"/home",className:"nes-btn is-primary",click:()=>{O.silence(),O.play("quit",t)},id:"btn-quit-final"}),s.a.createElement("button",{className:"nes-btn"},"Cancel"))))))});let L=s.a.createRef();const C=({index:e,currentLabel:t,timeLimit:a})=>{const{score:l,noRounds:o,msgs:c}=g(),[r,i]=Object(n.useState)(!1),{timeLeft:m,startTimer:d,stopTimer:u}=D(a,()=>{h()}),{roundDecider:h,isGameOver:p}=_({currentLabel:t,canvasRef:L,stopTimer:u});return Object(n.useEffect)(()=>(r&&(d(),console.log("GR: startTiming!")),()=>{u()}),[r]),s.a.createElement(f,{value:{index:e,currentLabel:t,timeLeft:m,canvasRef:L}},(()=>{if(p)return s.a.createElement(E.a,{to:{pathname:"/result",state:{score:l,noRounds:o,msgs:c}}})})(),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col"},s.a.createElement(b,null))),s.a.createElement("div",{className:"row align-items-end"},s.a.createElement("div",{className:"col"},s.a.createElement(y,{ref:L})),s.a.createElement("div",{className:"col mr-3 mb-2"},s.a.createElement(k,{label:t,timeLeft:m,callBack:()=>i(!0)}))),s.a.createElement(R,{canvasRef:L,NextBtnCallBack:h}))};var j=a(14);function T(e,t){const a=(n=e,j.b.fromPixels(n.current).resizeNearestNeighbor([28,28]).mean(2).expandDims(2).expandDims().toFloat().div(255));var n;return t.then(e=>e.predict(a).data()).then(async e=>await j.a(e).data())}function M({currentRound:e,noRounds:t,timeLimit:a,labels:n,randomiseLabels:l}){const o=s.a.useMemo(()=>l?(e=>{for(var t,a,n=e.length;0!==n;)a=Math.floor(Math.random()*n),t=e[n-=1],e[n]=e[a],e[a]=t;return e})(n.slice()):n,[]);let c=Array.apply(null,{length:t});return c=c.map((t,n)=>e===n?s.a.createElement(C,{index:n,key:n,timeLimit:a,currentLabel:o[n]}):null),{rounds:c}}const _=({canvasRef:e,currentLabel:t,stopTimer:a})=>{const[s,l]=Object(n.useState)(!1),[o]=I("soundOn"),{model:c,labels:r,currentRound:i,setCurrentRound:m,noRounds:d,score:u,dispatch:h,setWonLastRound:p}=g(),f=i===d;return Object(n.useEffect)(()=>{console.log("Score:",u,"/",d)},[i,s]),{roundDecider:()=>s?null:T(e,c).then(e=>{console.log("expectation: "+t,"VS prediction: "+r[e[0]]),r[e[0]]===t?(h({type:"ADD_POINTS"}),p(!0),f||O.play("point_win",o)):(p(!1),f||O.play("point_lose",o)),i<d-1?m(i+1):(l(!0),O.stop("theme"),a(),console.log("END GAME!"))}),isGameOver:s}},D=(e,t)=>{const[a,s]=Object(n.useState)(e),[l,o]=Object(n.useState)(!1);function c(){o(!1)}return Object(n.useEffect)(()=>{if(l){const e=setInterval(()=>{s(a-1)},1e3);return 0===a?(c(),clearInterval(e),void t.call()):()=>clearInterval(e)}},[l,a]),{timeLeft:a,startTimer:()=>{o(!0)},stopTimer:()=>c(),resetTimer:()=>(c(),void s(e))}},I=(e,t)=>{const[a,s]=Object(n.useState)(()=>{try{const a=window.localStorage.getItem(e);return a?JSON.parse(a):t}catch(a){return console.log(a),t}});return[a,t=>{try{const n=t instanceof Function?t(a):t;s(n),window.localStorage.setItem(e,JSON.stringify(n))}catch(n){console.log(n)}}]},P={typeSpeed:20,backSpeed:10,backDelay:50,startDelay:500},B=()=>{const[e,t]=I("soundOn");return void 0===e&&t(!0),Object(n.useEffect)(()=>{let e=new x.a(".typed-msg",{...P,stringsElement:".typed-src"});return()=>{e.destroy()}},[]),s.a.createElement("div",{className:"h-100 d-flex align-items-center"},s.a.createElement("div",{className:"container-sm"},s.a.createElement(r,null),s.a.createElement("section",{className:"message"},s.a.createElement("div",{className:"nes-balloon from-left d-block",style:{minHeight:"4.3em"}},s.a.createElement("div",{className:"typed-src d-none"},s.a.createElement("p",null,"This game has been modeled on Google's ",s.a.createElement("a",{href:"https://quickdraw.withgoogle.com/data"},"Quick, Draw!"),"^2000"),s.a.createElement("p",null,"^1000Brought to you by ",s.a.createElement("span",{className:"text-primary"},"@jvkdev")," and ",s.a.createElement("span",{className:"text-danger"},"Super Mari"),"^500"),s.a.createElement("p",null,"Brought to you by ",s.a.createElement("span",{className:"text-primary"},"@jvkdev")," and ",s.a.createElement("span",{className:"text-danger"},"EPFL Extension School")," ",s.a.createElement("i",{className:"nes-icon heart align-middle"}))),s.a.createElement("div",null,s.a.createElement("span",{className:"typed-msg"})))),s.a.createElement("i",{className:"nes-octocat animate float-left"}),s.a.createElement("div",{className:"float-right"},s.a.createElement(d,{isChecked:e,onChange:t,id:"option-sound"}),s.a.createElement(m,{route:"/game",click:()=>{O.play("click",e),O.play("theme",e)},id:"btn-play",label:"Play Game >",className:"mt-3",buttonClassName:"is-success"}))))},F=(e,t)=>{switch(t.type){case"RESET_POINTS":return 0;case"ADD_POINTS":return e+1;case"REMOVE_POINTS":return e-1;default:return e}};a(45),a(46);const q=({config:e})=>{const[t,a]=Object(n.useReducer)(F,0),[l,o]=Object(n.useState)(0),[c,i]=Object(n.useState)(!1),m={score:t,dispatch:a,currentRound:l,setCurrentRound:o,wonLastRound:c,setWonLastRound:i},{rounds:d}=M({...e,currentRound:l});return s.a.createElement(s.a.Fragment,null,s.a.createElement(r,null),s.a.createElement("div",{className:"nes-container is-rounded p-2",style:{backgroundColor:"rgba(0,0,0,0)"}},s.a.createElement(h,{value:{...e,...m}},d)))},G={config:{noRounds:10,timeLimit:20,model:async function(e){return console.log("TF: Model loading..."),await j.c(e).then(console.log("TF: Model loaded."))}("./assets/models/model.json"),labels:a(47),randomiseLabels:!0,msgs:{intro:"Let's get started.",question:'You have <span id="timeLeft">{{timeLeft}}</span> seconds to draw a <span class="text-danger">{{label}}</span>',questionSuffix:" in the box!",pointScore:["Not bad at all!","That was a fine sketch!","You're good!","Drawing is your fort\xe9!","Very arty!","Is that you, Picasso..?"],pointLose:["Need some drawing lessons...?!","Don't forget to wear your glasses...!","You can do better...!","Mehhh!","Don't give up your dayjob just yet.","No AI would understand that ;)"],win:{low:"Good effort! Your score could be better. Give it another go!",high:"Well done! Have you considered selling your masterpieces?",perfect:"Maestro! You win! You got them all correct :)",sound:"game_win"},lose:{low:"Oops... Try harder next time! Maybe you can score more than {{score}}!",high:"Almost there, but not quite!",sound:"game_lose"},pause:"^500 "}}},A=()=>s.a.createElement("div",{className:"h-100 d-flex align-items-center"},s.a.createElement("div",{className:"container-sm"},s.a.createElement(q,G))),H={typeSpeed:20,startDelay:500},W=e=>{const{score:t,noRounds:a,msgs:l}=e.location.state,[o]=I("soundOn"),c=Math.round(t/a*10);let i=!1,d=!1,u=!1,h=!1;10===c?i=!0:c>=8?d=!0:c>=6?u=!0:h=!0;const p=i?l.win.perfect:d?l.win.high:u?l.win.low:h?l.lose.low.replace("{{score}}",c):l.lose.high;return Object(n.useEffect)(()=>{let e="";e=d||u||i?l.win.sound:l.lose.sound,setTimeout(()=>O.play(e,o),1e3);let t=new x.a(".typed-msg",{...H,strings:[p]});return()=>{t.destroy()}},[]),s.a.createElement("div",{className:"h-100 d-flex align-items-center"},s.a.createElement("div",{className:"container-sm"},s.a.createElement(r,null),s.a.createElement("div",{className:"nes-container is-rounded p-2",style:{backgroundColor:"rgba(0,0,0,0)",minHeight:"10em"}},s.a.createElement("div",{className:"row align-content-center justify-content-center m-4",style:{height:"6em"}},s.a.createElement("div",{className:"nes-container is-rounded"},s.a.createElement("div",{className:"row align-items-center"},s.a.createElement(J,{wonHigh:d,wonLow:u,wonPerfect:i}),s.a.createElement("div",{className:"col",style:{whiteSpace:"nowrap"}},s.a.createElement(Y,{scoreFactored:c})),s.a.createElement("div",{className:"col"},s.a.createElement("h5",{className:"text-info pt-1"},"Score:"),s.a.createElement("h5",{className:""},t," / ",a))))),s.a.createElement("div",{className:"row align-items-end"},s.a.createElement("div",{className:"col-sm-0 col-md-4 col-lg-6"}),s.a.createElement("div",{className:"col-sm   col-md-8 col-lg-6"},s.a.createElement("section",{className:"message"},s.a.createElement("div",{className:"nes-balloon from-right d-block",style:{minHeight:"4.3em"}},s.a.createElement("div",null,s.a.createElement("span",{className:"typed-msg"})))))),s.a.createElement("div",{className:"row align-items-end"},s.a.createElement("div",{className:"col"},s.a.createElement("div",{className:"float-left pt-4"},s.a.createElement(m,{route:"/game",label:"Play Again"}),s.a.createElement(m,{route:"/home",label:"Home"}))),s.a.createElement("div",{className:"col"},s.a.createElement("i",{className:"nes-charmander float-right"}))))))},Y=({scoreFactored:e})=>{const t={f:s.a.createElement("i",{className:"nes-icon star"}),h:s.a.createElement("i",{className:"nes-icon star is-half"}),t:s.a.createElement("i",{className:"nes-icon star is-transparent"})};return["t.t.t.t.t","h.t.t.t.t","f.t.t.t.t","f.h.t.t.t","f.f.t.t.t","f.f.h.t.t","f.f.f.t.t","f.f.f.h.t","f.f.f.f.t","f.f.f.f.h","f.f.f.f.f"][e].split(".").map((e,a)=>s.a.createElement("span",{key:a},t[e]))},J=({wonPerfect:e,wonHigh:t,wonLow:a})=>e||t?s.a.createElement("div",{className:"col",style:{}},s.a.createElement("i",{className:"nes-icon trophy is-large"})):a?s.a.createElement("div",{className:"col",style:{}},s.a.createElement("i",{className:"nes-icon coin is-large"})):null,Q=()=>s.a.createElement(s.a.Fragment,null,s.a.createElement(E.d,null,s.a.createElement(E.b,{exact:!0,path:"/"},s.a.createElement(E.a,{to:"/home"})),s.a.createElement(E.b,{path:"/home",component:B}),s.a.createElement(E.b,{path:"/game",component:A}),s.a.createElement(U,null,s.a.createElement(E.b,{path:"/result",component:W}))));class U extends s.a.Component{constructor(e){super(e),this.state={error:null,errorInfo:null}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t})}render(){return this.state.errorInfo?s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"h-100 d-flex align-items-center"},s.a.createElement("div",{className:"container-sm text-center"},s.a.createElement("h2",null,"Oops.... "),s.a.createElement("h2",null,"Something went wrong!")))):this.props.children}}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(48),a(49);o.a.render(s.a.createElement(c.a,{basename:""},s.a.createElement(Q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()})}},[[25,1,2]]]);
//# sourceMappingURL=main.8ae6573c.chunk.js.map